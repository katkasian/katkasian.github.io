<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>Kateryna Kasianenko's Portfolio</title>

            <link href="https://katkasian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Kateryna Kasianenko's Portfolio Full Atom Feed" />
            <link href="https://katkasian.github.io/feeds/python.atom.xml" type="application/atom+xml" rel="alternate" title="Kateryna Kasianenko's Portfolio Categories Atom Feed" />

        <!-- Bootstrap Core CSS -->
        <link href="https://katkasian.github.io/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="https://katkasian.github.io/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="https://katkasian.github.io/theme/css/code_blocks/monokai.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->




        <meta name="tags" contents="python" />


			<meta property="og:locale" content="en">
		<meta property="og:site_name" content="Kateryna Kasianenko's Portfolio">

	<meta property="og:type" content="article">
	<meta property="article:author" content="">
	<meta property="og:url" content="https://katkasian.github.io/starbucks-offers.html">
	<meta property="og:title" content="Exploring Starbucks Offers Dataset">
	<meta property="og:description" content="">
	<meta property="og:image" content="https://katkasian.github.io/">
	<meta property="article:published_time" content="2020-04-19 00:00:00+10:00">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://katkasian.github.io/">Kateryna Kasianenko's Portfolio</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('https://katkasian.github.io/theme/images/post-bg.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Exploring Starbucks Offers Dataset</h1>
                        <span class="meta">Posted by
                                <a href="https://katkasian.github.io/author/me.html">me</a>
                             on Sun 19 April 2020
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <h1>Introduction</h1>
<p>This is an attempt to explore a Starbucks offers dataset, analyzed by some Medium users
(<a href="https://towardsdatascience.com/using-starbucks-app-user-data-to-predict-effective-offers-20b799f3a6d5">Syuen Loh</a>; <a href="https://towardsdatascience.com/starbucks-analyze-a-coffee-b4eef811aa4a">Saleh Alitr</a>). The aim for this stage of my work on this project, illustrated by this notebook, is to find some interesting questions that could be answered by the data at hand that have not been explored in the work of the aforementioned authors. In the later stages, I will aim to answer these questions.</p>
<div class="highlight"><pre><span></span><span class="c1">#importing necessary libraries</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">random</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#setting up the style and the color schema to be used</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn&#39;</span><span class="p">)</span>
<span class="n">my_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">,</span> <span class="s2">&quot;tab:orange&quot;</span><span class="p">,</span> <span class="s2">&quot;tab:olive&quot;</span><span class="p">,</span> <span class="s2">&quot;tab:pink&quot;</span><span class="p">,</span>
             <span class="s2">&quot;tab:cyan&quot;</span><span class="p">,</span> <span class="s2">&quot;tab:grey&quot;</span><span class="p">,</span> <span class="s2">&quot;tab:purple&quot;</span><span class="p">,</span> <span class="s2">&quot;tab:brown&quot;</span><span class="p">,</span>
             <span class="s2">&quot;gold&quot;</span><span class="p">,</span> <span class="s2">&quot;teal&quot;</span><span class="p">]</span>
</pre></div>


<h1><strong>Dataset Exploration 1. Exploring existing tables</strong></h1>
<h2><strong>Exploring Users</strong></h2>
<div class="highlight"><pre><span></span><span class="c1">##reading the profile table</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/salitr/starbucks_offers_analysis/master/profile.json&quot;</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df_users</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df_users</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>age</th>
      <th>id</th>
      <th>became_member_on</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>None</td>
      <td>118</td>
      <td>68be06ca386d4c31939f3a4f0e3dd783</td>
      <td>20170212</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>F</td>
      <td>55</td>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>20170715</td>
      <td>112000.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>None</td>
      <td>118</td>
      <td>38fe809add3b4fcf9315a9694bb96ff5</td>
      <td>20180712</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>F</td>
      <td>75</td>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>20170509</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>None</td>
      <td>118</td>
      <td>a03223e636434f42ac4c3df47e8bac43</td>
      <td>20170804</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="c1">#as some rows contain bad data (no gender and age 118), we need to drop rows with NaN</span>
<span class="n">df_users</span> <span class="o">=</span> <span class="n">df_users</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;any&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df_users</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>age</th>
      <th>id</th>
      <th>became_member_on</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>F</td>
      <td>55</td>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>20170715</td>
      <td>112000.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>F</td>
      <td>75</td>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>20170509</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>M</td>
      <td>68</td>
      <td>e2127556f4f64592b11af22de27a7932</td>
      <td>20180426</td>
      <td>70000.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>M</td>
      <td>65</td>
      <td>389bc3fa690240e798340f5a15918d5c</td>
      <td>20180209</td>
      <td>53000.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>M</td>
      <td>58</td>
      <td>2eeac8d8feae4a8cad5a6af0499a211d</td>
      <td>20171111</td>
      <td>51000.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>16995</th>
      <td>F</td>
      <td>45</td>
      <td>6d5f3a774f3d4714ab0c092238f3a1d7</td>
      <td>20180604</td>
      <td>54000.0</td>
    </tr>
    <tr>
      <th>16996</th>
      <td>M</td>
      <td>61</td>
      <td>2cb4f97358b841b9a9773a7aa05a9d77</td>
      <td>20180713</td>
      <td>72000.0</td>
    </tr>
    <tr>
      <th>16997</th>
      <td>M</td>
      <td>49</td>
      <td>01d26f638c274aa0b965d24cefe3183f</td>
      <td>20170126</td>
      <td>73000.0</td>
    </tr>
    <tr>
      <th>16998</th>
      <td>F</td>
      <td>83</td>
      <td>9dc1421481194dcd9400aec7c9ae6366</td>
      <td>20160307</td>
      <td>50000.0</td>
    </tr>
    <tr>
      <th>16999</th>
      <td>F</td>
      <td>62</td>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>20170722</td>
      <td>82000.0</td>
    </tr>
  </tbody>
</table>
<p>14825 rows × 5 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#exploring the gender distribution of users: grouping by gender and vizualizing </span>
<span class="c1">#the number of users identifying as certain gender, along with the proportion</span>
<span class="c1">#of a certain group</span>
<span class="n">genders</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_users</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;gender&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">/</span> <span class="n">df_users</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">df_users</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;gender&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">my_colors</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">genders</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">patch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">):</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">+</span> <span class="mi">30</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">get_y</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.21</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">genders</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> 
          <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;dimgrey&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Gender of users&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_12_0.png"></p>
<div class="highlight"><pre><span></span><span class="c1">#exploring the age distribution of the </span>
<span class="n">df_users</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>count    14825.000000
mean        54.393524
std         17.383705
min         18.000000
25%         42.000000
50%         55.000000
75%         66.000000
max        101.000000
Name: age, dtype: float64
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#exploring the age groups: dividing the users in 7 age groups </span>
<span class="n">df_users</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;agegroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">df_users</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">agegroup_proportion</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_users</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;agegroup&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">/</span> <span class="n">df_users</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">df_users</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;agegroup&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">my_colors</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">agegroup_proportion</span><span class="p">)])</span>
<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">patch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">):</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">get_x</span><span class="p">(),</span> <span class="n">patch</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">agegroup_proportion</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> 
          <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;dimgrey&#39;</span><span class="p">)</span>
<span class="n">labs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span>
<span class="n">texts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">lab</span> <span class="ow">in</span> <span class="n">labs</span><span class="p">:</span>
  <span class="n">str_to_modify</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">str_to_modify</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">))</span>
  <span class="n">texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Users by age&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_16_0.png"></p>
<div class="highlight"><pre><span></span><span class="c1">#converting the time of join column to datetime and exploring the timeframe of joining by year</span>
<span class="n">df_users</span><span class="p">[</span><span class="s2">&quot;became_member_dt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_users</span><span class="o">.</span><span class="n">became_member_on</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">6</span><span class="p">:]))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">year_propotion</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_users</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df_users</span><span class="o">.</span><span class="n">became_member_dt</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">/</span> <span class="n">df_users</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>
<span class="n">year_propotion</span>
</pre></div>


<div class="highlight"><pre><span></span>array([0.01848229, 0.0446543 , 0.10772344, 0.20397976, 0.37767285,
       0.24748735])
</pre></div>


<div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">df_users</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df_users</span><span class="o">.</span><span class="n">became_member_dt</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">my_colors</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">year_propotion</span><span class="p">)])</span>
<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">patch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">):</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">year_propotion</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> 
          <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;dimgrey&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Users by year of join&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_19_0.png"></p>
<div class="highlight"><pre><span></span><span class="c1">#exploring the income of users</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">df_users</span><span class="o">.</span><span class="n">income</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Income of users&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_users</span><span class="o">.</span><span class="n">income</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;tab:orange&quot;</span><span class="p">);</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_20_0.png"></p>
<p><em>Observations</em>: The dataset contains 15% more users identified as men than women, around 1% of users specified their gender as "other". Average income is around 60k a year. More than 80% of users have joined the platform from 2016 to 2018. Around 60% of users are in their 40s to 60s.</p>
<h2><strong>Exploring Events</strong></h2>
<div class="highlight"><pre><span></span><span class="c1">#reading the events table and checking the data</span>
<span class="n">path_events</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/salitr/starbucks_offers_analysis/master/transcript.json&quot;</span>
<span class="n">df_events</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">path_events</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df_events</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>306534.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>366.382940</td>
    </tr>
    <tr>
      <th>std</th>
      <td>200.326314</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>186.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>408.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>528.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>714.000000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">df_events</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 306534 entries, 0 to 306533
Data columns (total 4 columns):
 #   Column  Non-Null Count   Dtype 
---  ------  --------------   ----- 
 0   person  306534 non-null  object
 1   event   306534 non-null  object
 2   value   306534 non-null  object
 3   time    306534 non-null  int64 
dtypes: int64(1), object(3)
memory usage: 9.4+ MB
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#exploring types of events</span>
<span class="n">df_events</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>transaction        138953
offer received      76277
offer viewed        57725
offer completed     33579
Name: event, dtype: int64
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#there are two types of events: transactions and offers, each appears to have </span>
<span class="c1">#a &quot;time&quot; value, which, according to the explanation of the dataset, is the </span>
<span class="c1">#number of hours since the start of the offer </span>
<span class="n">df_events</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_events</span><span class="o">.</span><span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;transaction&#39;</span><span class="p">]</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>person</th>
      <th>event</th>
      <th>value</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>12654</th>
      <td>02c083884c7d45b39cc68e1314fec56c</td>
      <td>transaction</td>
      <td>{'amount': 0.8300000000000001}</td>
      <td>0</td>
    </tr>
    <tr>
      <th>12657</th>
      <td>9fa9ae8f57894cc9a3b8a9bbe0fc1b2f</td>
      <td>transaction</td>
      <td>{'amount': 34.56}</td>
      <td>0</td>
    </tr>
    <tr>
      <th>12659</th>
      <td>54890f68699049c2a04d415abc25e717</td>
      <td>transaction</td>
      <td>{'amount': 13.23}</td>
      <td>0</td>
    </tr>
    <tr>
      <th>12670</th>
      <td>b2f1cd155b864803ad8334cdf13c4bd2</td>
      <td>transaction</td>
      <td>{'amount': 19.51}</td>
      <td>0</td>
    </tr>
    <tr>
      <th>12671</th>
      <td>fe97aa22dd3e48c8b143116a8403dd52</td>
      <td>transaction</td>
      <td>{'amount': 18.97}</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>306529</th>
      <td>b3a1272bc9904337b331bf348c3e8c17</td>
      <td>transaction</td>
      <td>{'amount': 1.5899999999999999}</td>
      <td>714</td>
    </tr>
    <tr>
      <th>306530</th>
      <td>68213b08d99a4ae1b0dcb72aebd9aa35</td>
      <td>transaction</td>
      <td>{'amount': 9.53}</td>
      <td>714</td>
    </tr>
    <tr>
      <th>306531</th>
      <td>a00058cf10334a308c68e7631c529907</td>
      <td>transaction</td>
      <td>{'amount': 3.61}</td>
      <td>714</td>
    </tr>
    <tr>
      <th>306532</th>
      <td>76ddbd6576844afe811f1a3c0fbb5bec</td>
      <td>transaction</td>
      <td>{'amount': 3.5300000000000002}</td>
      <td>714</td>
    </tr>
    <tr>
      <th>306533</th>
      <td>c02b10e8752c4d8e9b73f918558531f7</td>
      <td>transaction</td>
      <td>{'amount': 4.05}</td>
      <td>714</td>
    </tr>
  </tbody>
</table>
<p>138953 rows × 4 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#plotting the average transaction time since the start of the offer</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df_events</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_events</span><span class="o">.</span><span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;transaction&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">my_colors</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of transactions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Hours&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Transactions by hours since the start of the offer&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">18000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_28_0.png"></p>
<div class="highlight"><pre><span></span><span class="c1">#plotting the duration of time since the beginning of the offer and an offer-related event</span>
<span class="n">offer_events</span> <span class="o">=</span> <span class="n">df_events</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_events</span><span class="o">.</span><span class="n">event</span> <span class="o">!=</span> <span class="s1">&#39;transaction&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">offer_events</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">offer_events</span><span class="o">.</span><span class="n">event</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">my_colors</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Offer event&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time, hours&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Offer-related events by time since the start of the offer&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_29_0.png"></p>
<p><em>Observations</em>: Clients appear to be receiving offers at different times - not only when the offer starts. Therefore, even though more transactions appear to be made in the later stage since the offer started, but there is a need to look at the time between an offer was received/viewed and the time a transaction was made.</p>
<h2><strong>Exploring Offers</strong></h2>
<div class="highlight"><pre><span></span><span class="c1">#reading the offers table</span>
<span class="n">path_offers</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/salitr/starbucks_offers_analysis/master/portfolio.json&quot;</span>
<span class="n">df_offers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">path_offers</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df_offers</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>reward</th>
      <th>channels</th>
      <th>difficulty</th>
      <th>duration</th>
      <th>offer_type</th>
      <th>id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10</td>
      <td>[email, mobile, social]</td>
      <td>10</td>
      <td>7</td>
      <td>bogo</td>
      <td>ae264e3637204a6fb9bb56bc8210ddfd</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10</td>
      <td>[web, email, mobile, social]</td>
      <td>10</td>
      <td>5</td>
      <td>bogo</td>
      <td>4d5c57ea9a6940dd891ad53e9dbe8da0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>[web, email, mobile]</td>
      <td>0</td>
      <td>4</td>
      <td>informational</td>
      <td>3f207df678b143eea3cee63160fa8bed</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5</td>
      <td>[web, email, mobile]</td>
      <td>5</td>
      <td>7</td>
      <td>bogo</td>
      <td>9b98b8c7a33c4b65b9aebfe6a799e6d9</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>[web, email]</td>
      <td>20</td>
      <td>10</td>
      <td>discount</td>
      <td>0b1e1539f2cc45b7b9fa7c272da2e1d7</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3</td>
      <td>[web, email, mobile, social]</td>
      <td>7</td>
      <td>7</td>
      <td>discount</td>
      <td>2298d6c36e964ae4a3e7e9706d1fb8c2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2</td>
      <td>[web, email, mobile, social]</td>
      <td>10</td>
      <td>10</td>
      <td>discount</td>
      <td>fafdcd668e3743c1bb461111dcafc2a4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>[email, mobile, social]</td>
      <td>0</td>
      <td>3</td>
      <td>informational</td>
      <td>5a8bc65990b245e5a138643cd4eb9837</td>
    </tr>
    <tr>
      <th>8</th>
      <td>5</td>
      <td>[web, email, mobile, social]</td>
      <td>5</td>
      <td>5</td>
      <td>bogo</td>
      <td>f19421c1d4aa40978ebb69ca19b0e20d</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2</td>
      <td>[web, email, mobile]</td>
      <td>10</td>
      <td>7</td>
      <td>discount</td>
      <td>2906b810c7d4411798c6938adc9daaa5</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="c1">#according to the description of the dataset, duration refers to days since the beginning of the offer.</span>
<span class="c1">#it might be helpful to convert it to hours as the events table records events in hours</span>
<span class="c1">#moreover, it might be interesting to know if a platform of distribtution affects the success of a campaign</span>
<span class="c1">#we will need to engineer separate columns for each platform</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#converting days to hours</span>
<span class="n">df_offers</span><span class="p">[</span><span class="s2">&quot;duration_hours&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_offers</span><span class="o">.</span><span class="n">duration</span> <span class="o">*</span> <span class="mi">24</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df_offers</span> <span class="o">=</span> <span class="n">df_offers</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#creating separate columns for offers</span>
<span class="n">df_offers</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_offers</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;email&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">df_offers</span><span class="p">[</span><span class="s1">&#39;web&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_offers</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;web&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">df_offers</span><span class="p">[</span><span class="s1">&#39;mobile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_offers</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;mobile&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">df_offers</span><span class="p">[</span><span class="s1">&#39;social&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_offers</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;social&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df_offers</span> <span class="o">=</span> <span class="n">df_offers</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;channels&quot;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#cleaned offers table</span>
<span class="n">df_offers</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>reward</th>
      <th>difficulty</th>
      <th>offer_type</th>
      <th>id</th>
      <th>duration_hours</th>
      <th>email</th>
      <th>web</th>
      <th>mobile</th>
      <th>social</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10</td>
      <td>10</td>
      <td>bogo</td>
      <td>ae264e3637204a6fb9bb56bc8210ddfd</td>
      <td>168</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10</td>
      <td>10</td>
      <td>bogo</td>
      <td>4d5c57ea9a6940dd891ad53e9dbe8da0</td>
      <td>120</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>informational</td>
      <td>3f207df678b143eea3cee63160fa8bed</td>
      <td>96</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5</td>
      <td>5</td>
      <td>bogo</td>
      <td>9b98b8c7a33c4b65b9aebfe6a799e6d9</td>
      <td>168</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>20</td>
      <td>discount</td>
      <td>0b1e1539f2cc45b7b9fa7c272da2e1d7</td>
      <td>240</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3</td>
      <td>7</td>
      <td>discount</td>
      <td>2298d6c36e964ae4a3e7e9706d1fb8c2</td>
      <td>168</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2</td>
      <td>10</td>
      <td>discount</td>
      <td>fafdcd668e3743c1bb461111dcafc2a4</td>
      <td>240</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>0</td>
      <td>informational</td>
      <td>5a8bc65990b245e5a138643cd4eb9837</td>
      <td>72</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>5</td>
      <td>5</td>
      <td>bogo</td>
      <td>f19421c1d4aa40978ebb69ca19b0e20d</td>
      <td>120</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2</td>
      <td>10</td>
      <td>discount</td>
      <td>2906b810c7d4411798c6938adc9daaa5</td>
      <td>168</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="c1">#exploring duration by hours</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df_offers</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_offers</span><span class="o">.</span><span class="n">duration_hours</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">my_colors</span><span class="p">[:</span><span class="n">df_offers</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_offers</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Offers by duration (hours)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_40_0.png"></p>
<div class="highlight"><pre><span></span><span class="n">df_offers</span><span class="o">.</span><span class="n">duration_hours</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>count     10.000000
mean     156.000000
std       55.713553
min       72.000000
25%      120.000000
50%      168.000000
75%      168.000000
max      240.000000
Name: duration_hours, dtype: float64
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#exploring duration by offer type</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df_offers</span><span class="o">.</span><span class="n">duration_hours</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">df_offers</span><span class="o">.</span><span class="n">offer_type</span><span class="p">,</span> 
               <span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">my_colors</span><span class="p">[:</span><span class="mi">3</span><span class="p">]))</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Duration of offers by type&quot;</span><span class="p">);</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_42_0.png"></p>
<div class="highlight"><pre><span></span><span class="c1">#exploring used platforms depending on the offer type</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">df_offers</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;offer_type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;web&quot;</span><span class="p">,</span> <span class="s2">&quot;mobile&quot;</span><span class="p">,</span> <span class="s2">&quot;social&quot;</span><span class="p">]]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">grouped</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">my_colors</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Platforms by offer type&quot;</span><span class="p">);</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_44_0.png"></p>
<div class="highlight"><pre><span></span><span class="n">df_offers</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;reward&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>difficulty</th>
      <th>offer_type</th>
      <th>id</th>
      <th>duration_hours</th>
      <th>email</th>
      <th>web</th>
      <th>mobile</th>
      <th>social</th>
    </tr>
    <tr>
      <th>reward</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>

<p>For 3 types of offers (BuyOneGetOne, Discount, Informational), no particular tendency exists by platform. Discount offers tend to be longer, and information offers shorter. As no offer can be longer than 240 hours, while for transactions it is 700, there is a need to distinguish between offer-related and non-offer-related transactions. There also appears to be no particular pattern between the amount of rewards (stars received in the event of completion) and the type of offer, so this could be an interesting metric to explore.</p>
<h1><strong>Dataset Exploration 2: Exploring merged tables</strong></h1>
<div class="highlight"><pre><span></span><span class="c1">#joining users and events tables (inner join)</span>
<span class="n">users_events</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_users</span><span class="p">,</span> <span class="n">df_events</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="n">df_users</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="n">df_events</span><span class="o">.</span><span class="n">person</span><span class="p">)</span>
<span class="n">users_events</span> <span class="o">=</span> <span class="n">users_events</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;key_0&quot;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">users_events</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>age</th>
      <th>id</th>
      <th>became_member_on</th>
      <th>income</th>
      <th>agegroup</th>
      <th>became_member_dt</th>
      <th>person</th>
      <th>event</th>
      <th>value</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>F</td>
      <td>55</td>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>20170715</td>
      <td>112000.0</td>
      <td>(50, 60]</td>
      <td>2017-07-15</td>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>transaction</td>
      <td>{'amount': 21.51}</td>
      <td>18</td>
    </tr>
    <tr>
      <th>1</th>
      <td>F</td>
      <td>55</td>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>20170715</td>
      <td>112000.0</td>
      <td>(50, 60]</td>
      <td>2017-07-15</td>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>transaction</td>
      <td>{'amount': 32.28}</td>
      <td>144</td>
    </tr>
    <tr>
      <th>2</th>
      <td>F</td>
      <td>55</td>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>20170715</td>
      <td>112000.0</td>
      <td>(50, 60]</td>
      <td>2017-07-15</td>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>offer received</td>
      <td>{'offer id': '9b98b8c7a33c4b65b9aebfe6a799e6d9'}</td>
      <td>408</td>
    </tr>
    <tr>
      <th>3</th>
      <td>F</td>
      <td>55</td>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>20170715</td>
      <td>112000.0</td>
      <td>(50, 60]</td>
      <td>2017-07-15</td>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>offer received</td>
      <td>{'offer id': '3f207df678b143eea3cee63160fa8bed'}</td>
      <td>504</td>
    </tr>
    <tr>
      <th>4</th>
      <td>F</td>
      <td>55</td>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>20170715</td>
      <td>112000.0</td>
      <td>(50, 60]</td>
      <td>2017-07-15</td>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>transaction</td>
      <td>{'amount': 23.22}</td>
      <td>528</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>272757</th>
      <td>F</td>
      <td>62</td>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>20170722</td>
      <td>82000.0</td>
      <td>(60, 70]</td>
      <td>2017-07-22</td>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>offer completed</td>
      <td>{'offer_id': 'f19421c1d4aa40978ebb69ca19b0e20d...</td>
      <td>480</td>
    </tr>
    <tr>
      <th>272758</th>
      <td>F</td>
      <td>62</td>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>20170722</td>
      <td>82000.0</td>
      <td>(60, 70]</td>
      <td>2017-07-22</td>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>transaction</td>
      <td>{'amount': 19.47}</td>
      <td>486</td>
    </tr>
    <tr>
      <th>272759</th>
      <td>F</td>
      <td>62</td>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>20170722</td>
      <td>82000.0</td>
      <td>(60, 70]</td>
      <td>2017-07-22</td>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>offer viewed</td>
      <td>{'offer id': 'f19421c1d4aa40978ebb69ca19b0e20d'}</td>
      <td>546</td>
    </tr>
    <tr>
      <th>272760</th>
      <td>F</td>
      <td>62</td>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>20170722</td>
      <td>82000.0</td>
      <td>(60, 70]</td>
      <td>2017-07-22</td>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>offer received</td>
      <td>{'offer id': '3f207df678b143eea3cee63160fa8bed'}</td>
      <td>576</td>
    </tr>
    <tr>
      <th>272761</th>
      <td>F</td>
      <td>62</td>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>20170722</td>
      <td>82000.0</td>
      <td>(60, 70]</td>
      <td>2017-07-22</td>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>transaction</td>
      <td>{'amount': 24.71}</td>
      <td>690</td>
    </tr>
  </tbody>
</table>
<p>272762 rows × 11 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#creating a table of transactons per user</span>
<span class="n">transactions</span> <span class="o">=</span> <span class="n">users_events</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">users_events</span><span class="o">.</span><span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;transaction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">transactions</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#creating a separate column for the amount of transaction, dropping value column</span>
<span class="n">transactions</span><span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">])</span>
<span class="n">transactions</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">transactions</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>person</th>
      <th>time</th>
      <th>amount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>18</td>
      <td>21.51</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>144</td>
      <td>32.28</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>528</td>
      <td>23.22</td>
    </tr>
    <tr>
      <th>8</th>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>132</td>
      <td>19.89</td>
    </tr>
    <tr>
      <th>10</th>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>144</td>
      <td>17.78</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>272752</th>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>84</td>
      <td>25.19</td>
    </tr>
    <tr>
      <th>272753</th>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>96</td>
      <td>21.53</td>
    </tr>
    <tr>
      <th>272756</th>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>480</td>
      <td>30.57</td>
    </tr>
    <tr>
      <th>272758</th>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>486</td>
      <td>19.47</td>
    </tr>
    <tr>
      <th>272761</th>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>690</td>
      <td>24.71</td>
    </tr>
  </tbody>
</table>
<p>123957 rows × 3 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#descriptive statistics on transactions per user</span>
<span class="c1">#number of transactions</span>
<span class="n">transactions_pu</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">transactions</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
<span class="n">transactions_pu</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>14492.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>8.553478</td>
    </tr>
    <tr>
      <th>std</th>
      <td>5.082696</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>5.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>7.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>11.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>36.000000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="c1">#average time since the offer and sum to spend</span>
<span class="n">amount_pu</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">amount_pu</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>amount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>14492.000000</td>
      <td>14492.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>389.614012</td>
      <td>15.252287</td>
    </tr>
    <tr>
      <th>std</th>
      <td>89.168780</td>
      <td>16.543371</td>
    </tr>
    <tr>
      <th>min</th>
      <td>12.000000</td>
      <td>0.150000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>331.500000</td>
      <td>3.890833</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>386.000000</td>
      <td>14.311214</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>442.200000</td>
      <td>21.467625</td>
    </tr>
    <tr>
      <th>max</th>
      <td>714.000000</td>
      <td>451.470000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="c1">#visualizing the metrics related to transactions per user</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">transactions_pu</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">my_colors</span><span class="p">))</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;N Transactions&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">transactions_pu</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;tab:orange&quot;</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">amount_pu</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">my_colors</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">amount_pu</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;tab:orange&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Avg Time&quot;</span><span class="p">)</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">amount_pu</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">my_colors</span><span class="p">))</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Avg Sum Spent&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">amount_pu</span><span class="o">.</span><span class="n">amount</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;tab:orange&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_54_0.png"></p>
<p><em>Observation</em>: It appears that there are outliers regarding average sum spent on an order, it might be useful to disregard them during analysis. On the other hand, average time since the start of the offer to the purchase appears to be past 240 hours - a maximum duration of the offer. It might suggest that conducting a transaction within the duration of the offer (i.e. completing the offer) is not a common behavior.</p>
<div class="highlight"><pre><span></span><span class="c1">#exploring user metrics by offers</span>
<span class="n">offer_actions</span> <span class="o">=</span> <span class="n">users_events</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">users_events</span><span class="o">.</span><span class="n">event</span> <span class="o">!=</span> <span class="s1">&#39;transaction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">offer_actions</span> <span class="o">=</span> <span class="n">offer_actions</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="s1">&#39;event&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">offer_actions</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>person</th>
      <th>event</th>
      <th>value</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>offer received</td>
      <td>{'offer id': '9b98b8c7a33c4b65b9aebfe6a799e6d9'}</td>
      <td>408</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>offer received</td>
      <td>{'offer id': '3f207df678b143eea3cee63160fa8bed'}</td>
      <td>504</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>offer completed</td>
      <td>{'offer_id': '9b98b8c7a33c4b65b9aebfe6a799e6d9...</td>
      <td>528</td>
    </tr>
    <tr>
      <th>6</th>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>offer received</td>
      <td>{'offer id': '9b98b8c7a33c4b65b9aebfe6a799e6d9'}</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>offer viewed</td>
      <td>{'offer id': '9b98b8c7a33c4b65b9aebfe6a799e6d9'}</td>
      <td>6</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>272754</th>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>offer received</td>
      <td>{'offer id': '3f207df678b143eea3cee63160fa8bed'}</td>
      <td>336</td>
    </tr>
    <tr>
      <th>272755</th>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>offer received</td>
      <td>{'offer id': 'f19421c1d4aa40978ebb69ca19b0e20d'}</td>
      <td>408</td>
    </tr>
    <tr>
      <th>272757</th>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>offer completed</td>
      <td>{'offer_id': 'f19421c1d4aa40978ebb69ca19b0e20d...</td>
      <td>480</td>
    </tr>
    <tr>
      <th>272759</th>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>offer viewed</td>
      <td>{'offer id': 'f19421c1d4aa40978ebb69ca19b0e20d'}</td>
      <td>546</td>
    </tr>
    <tr>
      <th>272760</th>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>offer received</td>
      <td>{'offer id': '3f207df678b143eea3cee63160fa8bed'}</td>
      <td>576</td>
    </tr>
  </tbody>
</table>
<p>148805 rows × 4 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#checking the contents of value column</span>
<span class="n">offer_actions</span><span class="p">[</span><span class="s2">&quot;types&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offer_actions</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">offer_actions</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>offer id           116361
offer_id,reward     32444
Name: types, dtype: int64
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#extracting offer id from value column</span>
<span class="n">offer_actions</span><span class="p">[</span><span class="s2">&quot;offer_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offer_actions</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">dic</span><span class="p">:</span><span class="n">dic</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">dic</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#checking the contents of value column when a reward is contained</span>
<span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">offer_actions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">offer_actions</span><span class="o">.</span><span class="n">event</span> <span class="o">==</span> <span class="s2">&quot;offer completed&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[:</span><span class="mi">15</span><span class="p">]:</span>
  <span class="k">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>{&#39;offer_id&#39;: &#39;9b98b8c7a33c4b65b9aebfe6a799e6d9&#39;, &#39;reward&#39;: 5}
{&#39;offer_id&#39;: &#39;9b98b8c7a33c4b65b9aebfe6a799e6d9&#39;, &#39;reward&#39;: 5}
{&#39;offer_id&#39;: &#39;ae264e3637204a6fb9bb56bc8210ddfd&#39;, &#39;reward&#39;: 10}
{&#39;offer_id&#39;: &#39;f19421c1d4aa40978ebb69ca19b0e20d&#39;, &#39;reward&#39;: 5}
{&#39;offer_id&#39;: &#39;9b98b8c7a33c4b65b9aebfe6a799e6d9&#39;, &#39;reward&#39;: 5}
{&#39;offer_id&#39;: &#39;fafdcd668e3743c1bb461111dcafc2a4&#39;, &#39;reward&#39;: 2}
{&#39;offer_id&#39;: &#39;f19421c1d4aa40978ebb69ca19b0e20d&#39;, &#39;reward&#39;: 5}
{&#39;offer_id&#39;: &#39;2906b810c7d4411798c6938adc9daaa5&#39;, &#39;reward&#39;: 2}
{&#39;offer_id&#39;: &#39;9b98b8c7a33c4b65b9aebfe6a799e6d9&#39;, &#39;reward&#39;: 5}
{&#39;offer_id&#39;: &#39;f19421c1d4aa40978ebb69ca19b0e20d&#39;, &#39;reward&#39;: 5}
{&#39;offer_id&#39;: &#39;fafdcd668e3743c1bb461111dcafc2a4&#39;, &#39;reward&#39;: 2}
{&#39;offer_id&#39;: &#39;fafdcd668e3743c1bb461111dcafc2a4&#39;, &#39;reward&#39;: 2}
{&#39;offer_id&#39;: &#39;4d5c57ea9a6940dd891ad53e9dbe8da0&#39;, &#39;reward&#39;: 10}
{&#39;offer_id&#39;: &#39;ae264e3637204a6fb9bb56bc8210ddfd&#39;, &#39;reward&#39;: 10}
{&#39;offer_id&#39;: &#39;f19421c1d4aa40978ebb69ca19b0e20d&#39;, &#39;reward&#39;: 5}
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#it appears that reward key stores the information already contained in offers table, so no need to extract it</span>
<span class="n">offer_actions</span> <span class="o">=</span> <span class="n">offer_actions</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">offer_actions</span> <span class="o">=</span> <span class="n">offer_actions</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;types&quot;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#next, we need to discard all the offer transactions that happened after the offer ended</span>
<span class="n">check_times</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">offer_actions</span><span class="p">,</span> <span class="n">df_offers</span><span class="o">.</span><span class="n">duration_hours</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">,</span>
                       <span class="n">left_on</span><span class="o">=</span><span class="n">offer_actions</span><span class="o">.</span><span class="n">offer_id</span><span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="n">df_offers</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">offer_actions</span> <span class="o">=</span> <span class="n">check_times</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">check_times</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">check_times</span><span class="o">.</span><span class="n">duration_hours</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">check_times</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">offer_actions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>(148805, 6)
(28297, 6)
</pre></div>


<div class="highlight"><pre><span></span><span class="n">offer_actions</span> <span class="o">=</span> <span class="n">offer_actions</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;key_0&quot;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">offer_actions</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">offer_actions</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">my_colors</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Offer-related actions&quot;</span><span class="p">);</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_68_0.png"></p>
<div class="highlight"><pre><span></span><span class="n">offer_actions</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>person</th>
      <th>event</th>
      <th>time</th>
      <th>offer_id</th>
      <th>duration_hours</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>offer received</td>
      <td>0</td>
      <td>9b98b8c7a33c4b65b9aebfe6a799e6d9</td>
      <td>168</td>
    </tr>
    <tr>
      <th>3</th>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>offer viewed</td>
      <td>6</td>
      <td>9b98b8c7a33c4b65b9aebfe6a799e6d9</td>
      <td>168</td>
    </tr>
    <tr>
      <th>4</th>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>offer completed</td>
      <td>132</td>
      <td>9b98b8c7a33c4b65b9aebfe6a799e6d9</td>
      <td>168</td>
    </tr>
    <tr>
      <th>16</th>
      <td>a448667f336b42c9a66fc5ffd5d73772</td>
      <td>offer received</td>
      <td>0</td>
      <td>9b98b8c7a33c4b65b9aebfe6a799e6d9</td>
      <td>168</td>
    </tr>
    <tr>
      <th>22</th>
      <td>ebe7ef46ea6f4963a7dd49f501b26779</td>
      <td>offer received</td>
      <td>0</td>
      <td>9b98b8c7a33c4b65b9aebfe6a799e6d9</td>
      <td>168</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>148792</th>
      <td>122c0c2a3c2540848f8c3fdc37e97639</td>
      <td>offer received</td>
      <td>0</td>
      <td>4d5c57ea9a6940dd891ad53e9dbe8da0</td>
      <td>120</td>
    </tr>
    <tr>
      <th>148793</th>
      <td>122c0c2a3c2540848f8c3fdc37e97639</td>
      <td>offer viewed</td>
      <td>6</td>
      <td>4d5c57ea9a6940dd891ad53e9dbe8da0</td>
      <td>120</td>
    </tr>
    <tr>
      <th>148794</th>
      <td>122c0c2a3c2540848f8c3fdc37e97639</td>
      <td>offer completed</td>
      <td>36</td>
      <td>4d5c57ea9a6940dd891ad53e9dbe8da0</td>
      <td>120</td>
    </tr>
    <tr>
      <th>148798</th>
      <td>ff737c250d2343729ade04c4f6eb1001</td>
      <td>offer received</td>
      <td>0</td>
      <td>4d5c57ea9a6940dd891ad53e9dbe8da0</td>
      <td>120</td>
    </tr>
    <tr>
      <th>148799</th>
      <td>ff737c250d2343729ade04c4f6eb1001</td>
      <td>offer viewed</td>
      <td>96</td>
      <td>4d5c57ea9a6940dd891ad53e9dbe8da0</td>
      <td>120</td>
    </tr>
  </tbody>
</table>
<p>28297 rows × 5 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#we need to see if the same offer can be made to the same person more than </span>
<span class="c1">#in order to check that, we group by person, offer_id and type of offer</span>
<span class="n">expl_num_offers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">offer_actions</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;offer_id&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">expl_num_offers</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">expl_num_offers</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>times</th>
    </tr>
    <tr>
      <th>person</th>
      <th>offer_id</th>
      <th>event</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">0011e0d4e6b944f998e987f904e8c1e5</th>
      <th rowspan="2" valign="top">3f207df678b143eea3cee63160fa8bed</th>
      <th>offer received</th>
      <td>1</td>
    </tr>
    <tr>
      <th>offer viewed</th>
      <td>1</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">0020c2b971eb4e9188eac86d93036a77</th>
      <th rowspan="3" valign="top">fafdcd668e3743c1bb461111dcafc2a4</th>
      <th>offer completed</th>
      <td>1</td>
    </tr>
    <tr>
      <th>offer received</th>
      <td>1</td>
    </tr>
    <tr>
      <th>offer viewed</th>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">ffff82501cea40309d5fdd7edcca4a07</th>
      <th rowspan="2" valign="top">0b1e1539f2cc45b7b9fa7c272da2e1d7</th>
      <th>offer received</th>
      <td>1</td>
    </tr>
    <tr>
      <th>offer viewed</th>
      <td>1</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">fafdcd668e3743c1bb461111dcafc2a4</th>
      <th>offer completed</th>
      <td>1</td>
    </tr>
    <tr>
      <th>offer received</th>
      <td>1</td>
    </tr>
    <tr>
      <th>offer viewed</th>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>28010 rows × 1 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#checking number and percentage of times users received an offer</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span>
<span class="n">expl_num_offers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[:,:,</span><span class="s2">&quot;offer received&quot;</span><span class="p">],</span><span class="s2">&quot;times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>1    12917
2      158
Name: times, dtype: int64
</pre></div>


<div class="highlight"><pre><span></span><span class="n">expl_num_offers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[:,:,</span><span class="s2">&quot;offer received&quot;</span><span class="p">],</span><span class="s2">&quot;times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="o">/</span> <span class="n">expl_num_offers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[:,:,</span><span class="s2">&quot;offer received&quot;</span><span class="p">],</span><span class="s2">&quot;times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>1    0.97612
2    0.01194
Name: times, dtype: float64
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#checking number and percentage of times users completed an offer</span>
<span class="n">expl_num_offers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[:,:,</span><span class="s2">&quot;offer completed&quot;</span><span class="p">],</span><span class="s2">&quot;times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>1    5327
2      52
Name: times, dtype: int64
</pre></div>


<div class="highlight"><pre><span></span><span class="n">expl_num_offers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[:,:,</span><span class="s2">&quot;offer completed&quot;</span><span class="p">],</span><span class="s2">&quot;times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="o">/</span> <span class="n">expl_num_offers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[:,:,</span><span class="s2">&quot;offer completed&quot;</span><span class="p">],</span><span class="s2">&quot;times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>1    0.980851
2    0.009575
Name: times, dtype: float64
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#checking number and percentage of times users viewed an offer</span>
<span class="n">expl_num_offers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[:,:,</span><span class="s2">&quot;offer viewed&quot;</span><span class="p">],</span><span class="s2">&quot;times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>1    9479
2      77
Name: times, dtype: int64
</pre></div>


<div class="highlight"><pre><span></span><span class="n">expl_num_offers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[:,:,</span><span class="s2">&quot;offer viewed&quot;</span><span class="p">],</span><span class="s2">&quot;times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="o">/</span> <span class="n">expl_num_offers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[:,:,</span><span class="s2">&quot;offer viewed&quot;</span><span class="p">],</span><span class="s2">&quot;times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>1    0.984013
2    0.007993
Name: times, dtype: float64
</pre></div>


<p><em>Observation</em>: In 98% of cases, a user can receive, view and complete only one offer per one campaign. It may be useful to drop other cases, as they may be technical errors.</p>
<div class="highlight"><pre><span></span><span class="c1">#filterring out all cases when a user received, viewed or completed a campaign twice</span>
<span class="n">expl_num_offers</span> <span class="o">=</span> <span class="n">expl_num_offers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">expl_num_offers</span><span class="o">.</span><span class="n">times</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">expl_num_offers</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>times</th>
    </tr>
    <tr>
      <th>person</th>
      <th>offer_id</th>
      <th>event</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">0011e0d4e6b944f998e987f904e8c1e5</th>
      <th rowspan="2" valign="top">3f207df678b143eea3cee63160fa8bed</th>
      <th>offer received</th>
      <td>1</td>
    </tr>
    <tr>
      <th>offer viewed</th>
      <td>1</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">0020c2b971eb4e9188eac86d93036a77</th>
      <th rowspan="3" valign="top">fafdcd668e3743c1bb461111dcafc2a4</th>
      <th>offer completed</th>
      <td>1</td>
    </tr>
    <tr>
      <th>offer received</th>
      <td>1</td>
    </tr>
    <tr>
      <th>offer viewed</th>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">ffff82501cea40309d5fdd7edcca4a07</th>
      <th rowspan="2" valign="top">0b1e1539f2cc45b7b9fa7c272da2e1d7</th>
      <th>offer received</th>
      <td>1</td>
    </tr>
    <tr>
      <th>offer viewed</th>
      <td>1</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">fafdcd668e3743c1bb461111dcafc2a4</th>
      <th>offer completed</th>
      <td>1</td>
    </tr>
    <tr>
      <th>offer received</th>
      <td>1</td>
    </tr>
    <tr>
      <th>offer viewed</th>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>27723 rows × 1 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#in order to reflect it in our offer actions dataframe, we merge exploratory dataframe and offer actions dataframe</span>
<span class="n">filtered_offer_actions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">expl_num_offers</span><span class="p">,</span> <span class="n">offer_actions</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;offer_id&quot;</span><span class="p">,</span><span class="s2">&quot;event&quot;</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">filtered_offer_actions</span> <span class="o">=</span><span class="n">filtered_offer_actions</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;times&quot;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#final offer actions dataframe</span>
<span class="n">filtered_offer_actions</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>person</th>
      <th>offer_id</th>
      <th>event</th>
      <th>time</th>
      <th>duration_hours</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0011e0d4e6b944f998e987f904e8c1e5</td>
      <td>3f207df678b143eea3cee63160fa8bed</td>
      <td>offer received</td>
      <td>0</td>
      <td>96</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0011e0d4e6b944f998e987f904e8c1e5</td>
      <td>3f207df678b143eea3cee63160fa8bed</td>
      <td>offer viewed</td>
      <td>6</td>
      <td>96</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0020c2b971eb4e9188eac86d93036a77</td>
      <td>fafdcd668e3743c1bb461111dcafc2a4</td>
      <td>offer completed</td>
      <td>54</td>
      <td>240</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0020c2b971eb4e9188eac86d93036a77</td>
      <td>fafdcd668e3743c1bb461111dcafc2a4</td>
      <td>offer received</td>
      <td>0</td>
      <td>240</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0020c2b971eb4e9188eac86d93036a77</td>
      <td>fafdcd668e3743c1bb461111dcafc2a4</td>
      <td>offer viewed</td>
      <td>12</td>
      <td>240</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>27718</th>
      <td>ffff82501cea40309d5fdd7edcca4a07</td>
      <td>0b1e1539f2cc45b7b9fa7c272da2e1d7</td>
      <td>offer received</td>
      <td>168</td>
      <td>240</td>
    </tr>
    <tr>
      <th>27719</th>
      <td>ffff82501cea40309d5fdd7edcca4a07</td>
      <td>0b1e1539f2cc45b7b9fa7c272da2e1d7</td>
      <td>offer viewed</td>
      <td>174</td>
      <td>240</td>
    </tr>
    <tr>
      <th>27720</th>
      <td>ffff82501cea40309d5fdd7edcca4a07</td>
      <td>fafdcd668e3743c1bb461111dcafc2a4</td>
      <td>offer completed</td>
      <td>60</td>
      <td>240</td>
    </tr>
    <tr>
      <th>27721</th>
      <td>ffff82501cea40309d5fdd7edcca4a07</td>
      <td>fafdcd668e3743c1bb461111dcafc2a4</td>
      <td>offer received</td>
      <td>0</td>
      <td>240</td>
    </tr>
    <tr>
      <th>27722</th>
      <td>ffff82501cea40309d5fdd7edcca4a07</td>
      <td>fafdcd668e3743c1bb461111dcafc2a4</td>
      <td>offer viewed</td>
      <td>6</td>
      <td>240</td>
    </tr>
  </tbody>
</table>
<p>27723 rows × 5 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#now it is safe to see how many campaigns each user participated in</span>
<span class="n">filtered_offer_actions</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()[</span><span class="s2">&quot;offer_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>2    4381
3    4127
1    2016
4     524
5     280
6     178
Name: offer_id, dtype: int64
</pre></div>


<div class="highlight"><pre><span></span><span class="n">n_offer_proportion</span> <span class="o">=</span> <span class="n">filtered_offer_actions</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()[</span><span class="s2">&quot;offer_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="o">/</span> <span class="n">filtered_offer_actions</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">n_offer_proportion</span> <span class="o">=</span> <span class="n">n_offer_proportion</span><span class="o">.</span><span class="n">values</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">n_offer_proportion</span>
</pre></div>


<div class="highlight"><pre><span></span>array([0.38075787, 0.35868243, 0.17521293, 0.04554146, 0.02433513,
       0.01547019])
</pre></div>


<div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">filtered_offer_actions</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()[</span><span class="s2">&quot;offer_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
        <span class="n">filtered_offer_actions</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()[</span><span class="s2">&quot;offer_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">my_colors</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">patch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">):</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span><span class="o">+</span> <span class="mi">60</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">n_offer_proportion</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> 
          <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;dimgrey&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Number of offers assigned&quot;</span><span class="p">);</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_89_0.png"></p>
<p><em>Observation</em>: We can see that more than 80% of users were assigned more than one campaign. It could be interesting to see if being assigned more campaigns leads to more purchases (during and after the campaign) and more completed campaigns.</p>
<div class="highlight"><pre><span></span><span class="c1">#next, we need to distinguish between the transactions conducted during the offer</span>
<span class="c1">#and transactions conducted after the offer has finished</span>
<span class="c1">#as 80% of users have been assigned multiple transactions and we do not have</span>
<span class="c1">#any information on when a transaction was conducted, we will use </span>
<span class="c1">#the longest number of hours an offer lasts (240 hours) as a proxy for</span>
<span class="c1">#offer-related transactions</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#filtering out users not in the filtered_offer_actions and therefore likely to have been assigned an offer</span>
<span class="c1">#different from the ones listed in the portfolio.json dataset</span>
<span class="n">transactions</span> <span class="o">=</span> <span class="n">transactions</span><span class="p">[</span><span class="n">transactions</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">filtered_offer_actions</span><span class="o">.</span><span class="n">person</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">transactions</span><span class="p">[</span><span class="s2">&quot;offer_related&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">240</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#number and proportion of offer-related transactions</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Related: &quot;</span><span class="p">,</span> <span class="n">transactions</span><span class="o">.</span><span class="n">offer_related</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Non-related: &quot;</span><span class="p">,</span> <span class="n">transactions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">transactions</span><span class="o">.</span><span class="n">offer_related</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">Related</span><span class="o">:</span>  <span class="mi">30923</span>
<span class="n">Non</span><span class="o">-</span><span class="n">related</span><span class="o">:</span>  <span class="mi">67986</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#plotting the proportion of transactions</span>
<span class="n">to_plot</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">to_plot</span><span class="p">[</span><span class="s2">&quot;Related&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">offer_related</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">to_plot</span><span class="p">[</span><span class="s2">&quot;Non-related&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">transactions</span><span class="o">.</span><span class="n">offer_related</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">to_plot</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">colors</span> <span class="o">=</span> <span class="n">my_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">autopct</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1.1f%%</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">my_circle</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">my_circle</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">to_plot</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Proportion of transactions by relation to offers&quot;</span><span class="p">);</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_95_0.png"></p>
<div class="highlight"><pre><span></span><span class="n">transactions</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>person</th>
      <th>time</th>
      <th>amount</th>
      <th>offer_related</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8</th>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>132</td>
      <td>19.89</td>
      <td>1</td>
    </tr>
    <tr>
      <th>10</th>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>144</td>
      <td>17.78</td>
      <td>1</td>
    </tr>
    <tr>
      <th>13</th>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>222</td>
      <td>19.67</td>
      <td>1</td>
    </tr>
    <tr>
      <th>14</th>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>240</td>
      <td>29.72</td>
      <td>1</td>
    </tr>
    <tr>
      <th>15</th>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>378</td>
      <td>23.93</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>272752</th>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>84</td>
      <td>25.19</td>
      <td>1</td>
    </tr>
    <tr>
      <th>272753</th>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>96</td>
      <td>21.53</td>
      <td>1</td>
    </tr>
    <tr>
      <th>272756</th>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>480</td>
      <td>30.57</td>
      <td>0</td>
    </tr>
    <tr>
      <th>272758</th>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>486</td>
      <td>19.47</td>
      <td>0</td>
    </tr>
    <tr>
      <th>272761</th>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>690</td>
      <td>24.71</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>98909 rows × 4 columns</p>
</div>

<h1><strong>Questions to answer</strong></h1>
<p>In the process of cleaning the data, I discovered that one user can be assigned one or more offers. This feature of the dataset gives me a chance to explore if Starbucks' customers are prone to "<a href="https://www.techopedia.com/definition/27373/deals-fatigue">deals fatigue</a>". We can also assume that for the different social groups results can be different. In this case study we will focus on gender. This leads us to the two following questions:</p>
<ul>
<li><strong>Q1: Does the higher number of transactions offered affect the number/amount of purchases? What if controlled for the time of joining?</strong></li>
<li><strong>Q2: Are there differences by gender?</strong></li>
</ul>
<p>Correspondingly, to answer these questions we will need a dataset based on users table, with additional information for each user regarding the number of campaigns offered, the number of offers viewed and completed, the number of offer-related and non-offer-related transactions, money spent during and between offers, as well as total money spent.</p>
<div class="highlight"><pre><span></span><span class="c1">#checking the number of offer/non-offer related transactions by person</span>
<span class="n">offer_trans</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;offer_related&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
<span class="n">offer_trans</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;non_off_related_trans&quot;</span><span class="p">,</span> <span class="s2">&quot;off_related_trans&quot;</span><span class="p">]</span>
<span class="n">offer_trans</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>non_off_related_trans</th>
      <th>off_related_trans</th>
    </tr>
    <tr>
      <th>person</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0011e0d4e6b944f998e987f904e8c1e5</th>
      <td>4.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>0020c2b971eb4e9188eac86d93036a77</th>
      <td>4.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>003d66b6608740288d6cc97a6903f4f0</th>
      <td>15.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>00426fe3ffde4c6b9cb9ad6d077a13ea</th>
      <td>8.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>004c5799adbf42868b9cff0396190900</th>
      <td>10.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>fff29fb549084123bd046dbc5ceb4faa</th>
      <td>7.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>fff3ba4757bd42088c044ca26d73817a</th>
      <td>4.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>fff7576017104bcc8677a8d63322b5e1</th>
      <td>4.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>fffad4f4828548d1b5583907f2e9906b</th>
      <td>7.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>ffff82501cea40309d5fdd7edcca4a07</th>
      <td>9.0</td>
      <td>6.0</td>
    </tr>
  </tbody>
</table>
<p>11240 rows × 2 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#reseting index before joining</span>
<span class="n">offer_trans</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">offer_trans</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>person</th>
      <th>non_off_related_trans</th>
      <th>off_related_trans</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0011e0d4e6b944f998e987f904e8c1e5</td>
      <td>4.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0020c2b971eb4e9188eac86d93036a77</td>
      <td>4.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>003d66b6608740288d6cc97a6903f4f0</td>
      <td>15.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>00426fe3ffde4c6b9cb9ad6d077a13ea</td>
      <td>8.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>004c5799adbf42868b9cff0396190900</td>
      <td>10.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>11235</th>
      <td>fff29fb549084123bd046dbc5ceb4faa</td>
      <td>7.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>11236</th>
      <td>fff3ba4757bd42088c044ca26d73817a</td>
      <td>4.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>11237</th>
      <td>fff7576017104bcc8677a8d63322b5e1</td>
      <td>4.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>11238</th>
      <td>fffad4f4828548d1b5583907f2e9906b</td>
      <td>7.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>11239</th>
      <td>ffff82501cea40309d5fdd7edcca4a07</td>
      <td>9.0</td>
      <td>6.0</td>
    </tr>
  </tbody>
</table>
<p>11240 rows × 3 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#merging users dataframe with transaction number dataframe by user</span>
<span class="n">merged_user_trans</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_users</span><span class="p">,</span> <span class="n">offer_trans</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="n">df_users</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
         <span class="n">right_on</span> <span class="o">=</span> <span class="n">offer_trans</span><span class="o">.</span><span class="n">person</span><span class="p">)</span>
<span class="n">merged_user_trans</span> <span class="o">=</span> <span class="n">merged_user_trans</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;key_0&#39;</span><span class="p">,</span> <span class="s1">&#39;person&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">merged_user_trans</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>age</th>
      <th>id</th>
      <th>became_member_on</th>
      <th>income</th>
      <th>agegroup</th>
      <th>became_member_dt</th>
      <th>non_off_related_trans</th>
      <th>off_related_trans</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>F</td>
      <td>55</td>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>20170715</td>
      <td>112000.0</td>
      <td>(50, 60]</td>
      <td>2017-07-15</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>F</td>
      <td>75</td>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>20170509</td>
      <td>100000.0</td>
      <td>(70, 80]</td>
      <td>2017-05-09</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>M</td>
      <td>68</td>
      <td>e2127556f4f64592b11af22de27a7932</td>
      <td>20180426</td>
      <td>70000.0</td>
      <td>(60, 70]</td>
      <td>2018-04-26</td>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>M</td>
      <td>65</td>
      <td>389bc3fa690240e798340f5a15918d5c</td>
      <td>20180209</td>
      <td>53000.0</td>
      <td>(60, 70]</td>
      <td>2018-02-09</td>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>M</td>
      <td>58</td>
      <td>2eeac8d8feae4a8cad5a6af0499a211d</td>
      <td>20171111</td>
      <td>51000.0</td>
      <td>(50, 60]</td>
      <td>2017-11-11</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>14820</th>
      <td>F</td>
      <td>45</td>
      <td>6d5f3a774f3d4714ab0c092238f3a1d7</td>
      <td>20180604</td>
      <td>54000.0</td>
      <td>(40, 50]</td>
      <td>2018-06-04</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>14821</th>
      <td>M</td>
      <td>61</td>
      <td>2cb4f97358b841b9a9773a7aa05a9d77</td>
      <td>20180713</td>
      <td>72000.0</td>
      <td>(60, 70]</td>
      <td>2018-07-13</td>
      <td>6.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>14822</th>
      <td>M</td>
      <td>49</td>
      <td>01d26f638c274aa0b965d24cefe3183f</td>
      <td>20170126</td>
      <td>73000.0</td>
      <td>(40, 50]</td>
      <td>2017-01-26</td>
      <td>7.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>14823</th>
      <td>F</td>
      <td>83</td>
      <td>9dc1421481194dcd9400aec7c9ae6366</td>
      <td>20160307</td>
      <td>50000.0</td>
      <td>(80, 90]</td>
      <td>2016-03-07</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>14824</th>
      <td>F</td>
      <td>62</td>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>20170722</td>
      <td>82000.0</td>
      <td>(60, 70]</td>
      <td>2017-07-22</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
<p>14825 rows × 9 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#replacing the null values with zeros</span>
<span class="n">merged_user_trans</span><span class="o">.</span><span class="n">off_related_trans</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">merged_user_trans</span><span class="o">.</span><span class="n">non_off_related_trans</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#checking descriptive statistics regarding offer-related-transactions</span>
<span class="n">merged_user_trans</span><span class="o">.</span><span class="n">off_related_trans</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>count    14825.000000
mean         2.085868
std          2.375044
min          0.000000
25%          0.000000
50%          1.000000
75%          3.000000
max         16.000000
Name: off_related_trans, dtype: float64
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#checking descriptive statistics regarding non-offer-related-transactions</span>
<span class="n">merged_user_trans</span><span class="o">.</span><span class="n">non_off_related_trans</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>count    14825.000000
mean         4.585902
std          4.171664
min          0.000000
25%          1.000000
50%          4.000000
75%          7.000000
max         31.000000
Name: non_off_related_trans, dtype: float64
</pre></div>


<div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Related&quot;</span><span class="p">,</span><span class="s2">&quot;Non-related&quot;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">merged_user_trans</span><span class="o">.</span><span class="n">off_related_trans</span><span class="p">,</span> 
                                                <span class="n">merged_user_trans</span><span class="o">.</span><span class="n">non_off_related_trans</span><span class="p">],</span>
            <span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">my_colors</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">]))</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Offer related and non-related transactions&quot;</span><span class="p">);</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_108_0.png"></p>
<div class="highlight"><pre><span></span><span class="c1">#checking users who did not conduct any offer-related or non-offer related transactions </span>
<span class="n">no_trans</span> <span class="o">=</span> <span class="n">merged_user_trans</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">merged_user_trans</span><span class="o">.</span><span class="n">off_related_trans</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> 
                            <span class="p">(</span><span class="n">merged_user_trans</span><span class="o">.</span><span class="n">non_off_related_trans</span> <span class="o">==</span><span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;People with no transactions:&quot;</span><span class="p">,</span> <span class="n">no_trans</span><span class="p">,</span> <span class="s2">&quot;or&quot;</span><span class="p">,</span>
       <span class="n">f</span><span class="s2">&quot;{no_trans/merged_user_trans.shape[0]:.2f}%&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>People with no transactions: 3585 or 0.24%
</pre></div>


<div class="highlight"><pre><span></span><span class="n">no_trans</span> <span class="o">=</span> <span class="n">merged_user_trans</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">merged_user_trans</span><span class="o">.</span><span class="n">off_related_trans</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> 
                            <span class="p">(</span><span class="n">merged_user_trans</span><span class="o">.</span><span class="n">non_off_related_trans</span> <span class="o">!=</span><span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;People with only non-offer related transactions:&quot;</span><span class="p">,</span> <span class="n">no_trans</span><span class="p">,</span> <span class="s2">&quot;or&quot;</span><span class="p">,</span>
       <span class="n">f</span><span class="s2">&quot;{no_trans/merged_user_trans.shape[0]:.2f}%&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>People with only non-offer related transactions: 1768 or 0.12%
</pre></div>


<div class="highlight"><pre><span></span><span class="n">no_trans</span> <span class="o">=</span> <span class="n">merged_user_trans</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">merged_user_trans</span><span class="o">.</span><span class="n">off_related_trans</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> 
                            <span class="p">(</span><span class="n">merged_user_trans</span><span class="o">.</span><span class="n">non_off_related_trans</span> <span class="o">==</span><span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;People with only offer-related transactions:&quot;</span><span class="p">,</span> <span class="n">no_trans</span><span class="p">,</span> <span class="s2">&quot;or&quot;</span><span class="p">,</span>
       <span class="n">f</span><span class="s2">&quot;{no_trans/merged_user_trans.shape[0]:.2f}%&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>People with only offer-related transactions: 31 or 0.00%
</pre></div>


<p><em>Observation</em>: even though non-offer related transactions outnumber offer-related transactions, overwhelming majority of people in the dataset conducted some offer-related transactions</p>
<div class="highlight"><pre><span></span><span class="c1">#next, we will check how much money users spent on offer-related and non-offer-</span>
<span class="c1">#related transactions</span>
<span class="n">sum_tr_offer</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;offer_related&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
<span class="n">sum_tr_offer</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;spent_non_offer_related&quot;</span><span class="p">,</span> <span class="s2">&quot;spent_offer_related&quot;</span><span class="p">]</span>
<span class="n">sum_tr_offer</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">sum_tr_offer</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>person</th>
      <th>spent_non_offer_related</th>
      <th>spent_offer_related</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0011e0d4e6b944f998e987f904e8c1e5</td>
      <td>65.97</td>
      <td>13.49</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0020c2b971eb4e9188eac86d93036a77</td>
      <td>98.53</td>
      <td>98.33</td>
    </tr>
    <tr>
      <th>2</th>
      <td>003d66b6608740288d6cc97a6903f4f0</td>
      <td>44.35</td>
      <td>3.99</td>
    </tr>
    <tr>
      <th>3</th>
      <td>00426fe3ffde4c6b9cb9ad6d077a13ea</td>
      <td>31.22</td>
      <td>37.29</td>
    </tr>
    <tr>
      <th>4</th>
      <td>004c5799adbf42868b9cff0396190900</td>
      <td>275.88</td>
      <td>71.50</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>11235</th>
      <td>fff29fb549084123bd046dbc5ceb4faa</td>
      <td>190.42</td>
      <td>101.05</td>
    </tr>
    <tr>
      <th>11236</th>
      <td>fff3ba4757bd42088c044ca26d73817a</td>
      <td>447.59</td>
      <td>133.39</td>
    </tr>
    <tr>
      <th>11237</th>
      <td>fff7576017104bcc8677a8d63322b5e1</td>
      <td>18.40</td>
      <td>11.54</td>
    </tr>
    <tr>
      <th>11238</th>
      <td>fffad4f4828548d1b5583907f2e9906b</td>
      <td>56.58</td>
      <td>32.25</td>
    </tr>
    <tr>
      <th>11239</th>
      <td>ffff82501cea40309d5fdd7edcca4a07</td>
      <td>137.52</td>
      <td>88.55</td>
    </tr>
  </tbody>
</table>
<p>11240 rows × 3 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#we will add this information to our user dataframe</span>
<span class="n">merged_user_sum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">merged_user_trans</span><span class="p">,</span> <span class="n">sum_tr_offer</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="n">merged_user_trans</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
         <span class="n">right_on</span> <span class="o">=</span> <span class="n">sum_tr_offer</span><span class="o">.</span><span class="n">person</span><span class="p">)</span>
<span class="n">merged_user_sum</span> <span class="o">=</span> <span class="n">merged_user_sum</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;key_0&#39;</span><span class="p">,</span> <span class="s1">&#39;person&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">merged_user_sum</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>age</th>
      <th>id</th>
      <th>became_member_on</th>
      <th>income</th>
      <th>agegroup</th>
      <th>became_member_dt</th>
      <th>non_off_related_trans</th>
      <th>off_related_trans</th>
      <th>spent_non_offer_related</th>
      <th>spent_offer_related</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>F</td>
      <td>55</td>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>20170715</td>
      <td>112000.0</td>
      <td>(50, 60]</td>
      <td>2017-07-15</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>F</td>
      <td>75</td>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>20170509</td>
      <td>100000.0</td>
      <td>(70, 80]</td>
      <td>2017-05-09</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>72.21</td>
      <td>87.06</td>
    </tr>
    <tr>
      <th>2</th>
      <td>M</td>
      <td>68</td>
      <td>e2127556f4f64592b11af22de27a7932</td>
      <td>20180426</td>
      <td>70000.0</td>
      <td>(60, 70]</td>
      <td>2018-04-26</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>57.73</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>M</td>
      <td>65</td>
      <td>389bc3fa690240e798340f5a15918d5c</td>
      <td>20180209</td>
      <td>53000.0</td>
      <td>(60, 70]</td>
      <td>2018-02-09</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>26.89</td>
      <td>9.54</td>
    </tr>
    <tr>
      <th>4</th>
      <td>M</td>
      <td>58</td>
      <td>2eeac8d8feae4a8cad5a6af0499a211d</td>
      <td>20171111</td>
      <td>51000.0</td>
      <td>(50, 60]</td>
      <td>2017-11-11</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>13.30</td>
      <td>2.32</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>14820</th>
      <td>F</td>
      <td>45</td>
      <td>6d5f3a774f3d4714ab0c092238f3a1d7</td>
      <td>20180604</td>
      <td>54000.0</td>
      <td>(40, 50]</td>
      <td>2018-06-04</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>14821</th>
      <td>M</td>
      <td>61</td>
      <td>2cb4f97358b841b9a9773a7aa05a9d77</td>
      <td>20180713</td>
      <td>72000.0</td>
      <td>(60, 70]</td>
      <td>2018-07-13</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>23.04</td>
      <td>2.93</td>
    </tr>
    <tr>
      <th>14822</th>
      <td>M</td>
      <td>49</td>
      <td>01d26f638c274aa0b965d24cefe3183f</td>
      <td>20170126</td>
      <td>73000.0</td>
      <td>(40, 50]</td>
      <td>2017-01-26</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>36.44</td>
      <td>3.30</td>
    </tr>
    <tr>
      <th>14823</th>
      <td>F</td>
      <td>83</td>
      <td>9dc1421481194dcd9400aec7c9ae6366</td>
      <td>20160307</td>
      <td>50000.0</td>
      <td>(80, 90]</td>
      <td>2016-03-07</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>14824</th>
      <td>F</td>
      <td>62</td>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>20170722</td>
      <td>82000.0</td>
      <td>(60, 70]</td>
      <td>2017-07-22</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>74.75</td>
      <td>68.27</td>
    </tr>
  </tbody>
</table>
<p>14825 rows × 11 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#replacing null values in newly added columns with zeros</span>
<span class="n">merged_user_sum</span><span class="o">.</span><span class="n">spent_non_offer_related</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">merged_user_sum</span><span class="o">.</span><span class="n">spent_offer_related</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">merged_user_sum</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>age</th>
      <th>id</th>
      <th>became_member_on</th>
      <th>income</th>
      <th>agegroup</th>
      <th>became_member_dt</th>
      <th>non_off_related_trans</th>
      <th>off_related_trans</th>
      <th>spent_non_offer_related</th>
      <th>spent_offer_related</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>F</td>
      <td>55</td>
      <td>0610b486422d4921ae7d2bf64640c50b</td>
      <td>20170715</td>
      <td>112000.0</td>
      <td>(50, 60]</td>
      <td>2017-07-15</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>F</td>
      <td>75</td>
      <td>78afa995795e4d85b5d9ceeca43f5fef</td>
      <td>20170509</td>
      <td>100000.0</td>
      <td>(70, 80]</td>
      <td>2017-05-09</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>72.21</td>
      <td>87.06</td>
    </tr>
    <tr>
      <th>2</th>
      <td>M</td>
      <td>68</td>
      <td>e2127556f4f64592b11af22de27a7932</td>
      <td>20180426</td>
      <td>70000.0</td>
      <td>(60, 70]</td>
      <td>2018-04-26</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>57.73</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>M</td>
      <td>65</td>
      <td>389bc3fa690240e798340f5a15918d5c</td>
      <td>20180209</td>
      <td>53000.0</td>
      <td>(60, 70]</td>
      <td>2018-02-09</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>26.89</td>
      <td>9.54</td>
    </tr>
    <tr>
      <th>4</th>
      <td>M</td>
      <td>58</td>
      <td>2eeac8d8feae4a8cad5a6af0499a211d</td>
      <td>20171111</td>
      <td>51000.0</td>
      <td>(50, 60]</td>
      <td>2017-11-11</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>13.30</td>
      <td>2.32</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>14820</th>
      <td>F</td>
      <td>45</td>
      <td>6d5f3a774f3d4714ab0c092238f3a1d7</td>
      <td>20180604</td>
      <td>54000.0</td>
      <td>(40, 50]</td>
      <td>2018-06-04</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>14821</th>
      <td>M</td>
      <td>61</td>
      <td>2cb4f97358b841b9a9773a7aa05a9d77</td>
      <td>20180713</td>
      <td>72000.0</td>
      <td>(60, 70]</td>
      <td>2018-07-13</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>23.04</td>
      <td>2.93</td>
    </tr>
    <tr>
      <th>14822</th>
      <td>M</td>
      <td>49</td>
      <td>01d26f638c274aa0b965d24cefe3183f</td>
      <td>20170126</td>
      <td>73000.0</td>
      <td>(40, 50]</td>
      <td>2017-01-26</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>36.44</td>
      <td>3.30</td>
    </tr>
    <tr>
      <th>14823</th>
      <td>F</td>
      <td>83</td>
      <td>9dc1421481194dcd9400aec7c9ae6366</td>
      <td>20160307</td>
      <td>50000.0</td>
      <td>(80, 90]</td>
      <td>2016-03-07</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>14824</th>
      <td>F</td>
      <td>62</td>
      <td>e4052622e5ba45a8b96b59aba68cf068</td>
      <td>20170722</td>
      <td>82000.0</td>
      <td>(60, 70]</td>
      <td>2017-07-22</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>74.75</td>
      <td>68.27</td>
    </tr>
  </tbody>
</table>
<p>14825 rows × 11 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Related&quot;</span><span class="p">,</span><span class="s2">&quot;Non-related&quot;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">merged_user_sum</span><span class="o">.</span><span class="n">spent_offer_related</span><span class="p">,</span>
                                                <span class="n">merged_user_sum</span><span class="o">.</span><span class="n">spent_non_offer_related</span><span class="p">],</span>
            <span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">my_colors</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">9</span><span class="p">]))</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Money spent, offer related and non-related&quot;</span><span class="p">);</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_117_0.png"></p>
<div class="highlight"><pre><span></span><span class="n">merged_user_sum</span><span class="o">.</span><span class="n">spent_offer_related</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>count    14825.000000
mean        28.791158
std         56.475480
min          0.000000
25%          0.000000
50%         10.680000
75%         40.970000
max       1136.200000
Name: spent_offer_related, dtype: float64
</pre></div>


<div class="highlight"><pre><span></span><span class="n">merged_user_sum</span><span class="o">.</span><span class="n">spent_non_offer_related</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>count    14825.000000
mean        64.295125
std         95.986697
min          0.000000
25%          2.090000
50%         34.780000
75%         95.000000
max       1287.250000
Name: spent_non_offer_related, dtype: float64
</pre></div>


<p><em>Observation</em>: We see that in terms of sum of money spent on both offer-related and non-offer-related transactions, there are outliers that are skewing the distribution to the right. Before proceeding with further analysis, we need to handle the outliers. We will do that through only using the data between 85 and 15% quantile.</p>
<div class="highlight"><pre><span></span><span class="c1">#filtering out outliers for non-offer-related and offer-related sum</span>
<span class="n">merged_user_sum_no_outl</span> <span class="o">=</span> <span class="n">merged_user_sum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>\
                                              <span class="n">merged_user_sum</span><span class="o">.</span><span class="n">spent_non_offer_related</span><span class="o">.</span><span class="n">between</span>\
                                              <span class="p">(</span><span class="n">merged_user_sum</span><span class="o">.</span><span class="n">spent_non_offer_related</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="o">.</span><span class="mi">15</span><span class="p">),</span>
                                              <span class="n">merged_user_sum</span><span class="o">.</span><span class="n">spent_non_offer_related</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="o">.</span><span class="mi">85</span><span class="p">))]</span>
<span class="n">merged_user_sum_no_outl</span> <span class="o">=</span> <span class="n">merged_user_sum_no_outl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>\
                                              <span class="n">merged_user_sum_no_outl</span><span class="o">.</span><span class="n">spent_offer_related</span><span class="o">.</span><span class="n">between</span>\
                                              <span class="p">(</span><span class="n">merged_user_sum_no_outl</span><span class="o">.</span><span class="n">spent_offer_related</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="o">.</span><span class="mi">15</span><span class="p">),</span>
                                              <span class="n">merged_user_sum_no_outl</span><span class="o">.</span><span class="n">spent_offer_related</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="o">.</span><span class="mi">85</span><span class="p">))]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#checking the number of users left out</span>
<span class="n">merged_user_sum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_user_sum_no_outl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span>4113
</pre></div>


<div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Related&quot;</span><span class="p">,</span><span class="s2">&quot;Non-related&quot;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">merged_user_sum_no_outl</span><span class="o">.</span><span class="n">spent_offer_related</span><span class="p">,</span>
                                                <span class="n">merged_user_sum_no_outl</span><span class="o">.</span><span class="n">spent_non_offer_related</span><span class="p">],</span>
            <span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">my_colors</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">9</span><span class="p">]))</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Money spent, offer related and non-related (outliers dropped)&quot;</span><span class="p">);</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_123_0.png"></p>
<div class="highlight"><pre><span></span><span class="n">merged_user_sum_no_outl</span><span class="o">.</span><span class="n">spent_offer_related</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>count    10712.000000
mean         9.484548
std         13.111000
min          0.000000
25%          0.000000
50%          1.340000
75%         16.432500
max         48.360000
Name: spent_offer_related, dtype: float64
</pre></div>


<div class="highlight"><pre><span></span><span class="n">merged_user_sum_no_outl</span><span class="o">.</span><span class="n">spent_non_offer_related</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>count    10712.000000
mean        29.016984
std         34.840995
min          0.000000
25%          0.000000
50%         14.675000
75%         47.007500
max        130.870000
Name: spent_non_offer_related, dtype: float64
</pre></div>


<p>The distribution of sums is looking much better! Now we can add the columns related to offers users were assigned to, viewed and completed.</p>
<div class="highlight"><pre><span></span><span class="c1">#creating a dataframe with number of received, viewed and completed offers by user</span>
<span class="n">offers_by_user</span> <span class="o">=</span> <span class="n">filtered_offer_actions</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()[</span><span class="s2">&quot;offer_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
<span class="n">offers_by_user</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;offers_completed&quot;</span><span class="p">,</span> <span class="s2">&quot;offers_received&quot;</span><span class="p">,</span> <span class="s2">&quot;offers_viewed&quot;</span><span class="p">]</span>
<span class="n">offers_by_user</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">offers_by_user</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>person</th>
      <th>offers_completed</th>
      <th>offers_received</th>
      <th>offers_viewed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0011e0d4e6b944f998e987f904e8c1e5</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0020c2b971eb4e9188eac86d93036a77</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>003d66b6608740288d6cc97a6903f4f0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>00426fe3ffde4c6b9cb9ad6d077a13ea</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>004c5799adbf42868b9cff0396190900</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>11501</th>
      <td>fff29fb549084123bd046dbc5ceb4faa</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>11502</th>
      <td>fff3ba4757bd42088c044ca26d73817a</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>11503</th>
      <td>fff7576017104bcc8677a8d63322b5e1</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>11504</th>
      <td>fffad4f4828548d1b5583907f2e9906b</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>11505</th>
      <td>ffff82501cea40309d5fdd7edcca4a07</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
<p>11506 rows × 4 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#adding the information about number of offers to the dataframe with users/transactions info</span>
<span class="c1">#we need only users who were assigned offers, so we perform an inner join</span>
<span class="n">final</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">merged_user_sum_no_outl</span><span class="p">,</span> <span class="n">offers_by_user</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">,</span> 
         <span class="n">left_on</span> <span class="o">=</span> <span class="n">merged_user_sum_no_outl</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="n">offers_by_user</span><span class="o">.</span><span class="n">person</span><span class="p">)</span>
<span class="n">final</span> <span class="o">=</span> <span class="n">final</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;key_0&quot;</span><span class="p">,</span> <span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;became_member_on&quot;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">#replacing null values with zeros</span>
<span class="n">final</span><span class="o">.</span><span class="n">offers_completed</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">final</span><span class="o">.</span><span class="n">offers_received</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">final</span><span class="o">.</span><span class="n">offers_viewed</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">final</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>age</th>
      <th>id</th>
      <th>income</th>
      <th>agegroup</th>
      <th>became_member_dt</th>
      <th>non_off_related_trans</th>
      <th>off_related_trans</th>
      <th>spent_non_offer_related</th>
      <th>spent_offer_related</th>
      <th>offers_completed</th>
      <th>offers_received</th>
      <th>offers_viewed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>M</td>
      <td>68</td>
      <td>e2127556f4f64592b11af22de27a7932</td>
      <td>70000.0</td>
      <td>(60, 70]</td>
      <td>2018-04-26</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>57.73</td>
      <td>0.00</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>M</td>
      <td>65</td>
      <td>389bc3fa690240e798340f5a15918d5c</td>
      <td>53000.0</td>
      <td>(60, 70]</td>
      <td>2018-02-09</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>26.89</td>
      <td>9.54</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>M</td>
      <td>58</td>
      <td>2eeac8d8feae4a8cad5a6af0499a211d</td>
      <td>51000.0</td>
      <td>(50, 60]</td>
      <td>2017-11-11</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>13.30</td>
      <td>2.32</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>F</td>
      <td>61</td>
      <td>aa4862eba776480b8bb9c68455b8c2e1</td>
      <td>57000.0</td>
      <td>(60, 70]</td>
      <td>2017-09-11</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>73.22</td>
      <td>12.33</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>M</td>
      <td>26</td>
      <td>e12aeaf2d47d42479ea1c4ac3d8286c6</td>
      <td>46000.0</td>
      <td>(18, 30]</td>
      <td>2014-02-13</td>
      <td>8.0</td>
      <td>3.0</td>
      <td>42.12</td>
      <td>14.10</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7388</th>
      <td>F</td>
      <td>59</td>
      <td>bf3069b178fe40d789dd027901bc406b</td>
      <td>63000.0</td>
      <td>(50, 60]</td>
      <td>2017-07-31</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>75.16</td>
      <td>0.00</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>7389</th>
      <td>M</td>
      <td>64</td>
      <td>f653cf2d8bba42d0a53c2937ee2e5893</td>
      <td>51000.0</td>
      <td>(60, 70]</td>
      <td>2018-01-04</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>19.48</td>
      <td>12.96</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>7390</th>
      <td>F</td>
      <td>21</td>
      <td>400d0536e8794cbb855b0d882d67cbda</td>
      <td>72000.0</td>
      <td>(18, 30]</td>
      <td>2017-09-17</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>7.25</td>
      <td>10.62</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>7391</th>
      <td>M</td>
      <td>61</td>
      <td>2cb4f97358b841b9a9773a7aa05a9d77</td>
      <td>72000.0</td>
      <td>(60, 70]</td>
      <td>2018-07-13</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>23.04</td>
      <td>2.93</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>7392</th>
      <td>M</td>
      <td>49</td>
      <td>01d26f638c274aa0b965d24cefe3183f</td>
      <td>73000.0</td>
      <td>(40, 50]</td>
      <td>2017-01-26</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>36.44</td>
      <td>3.30</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>7393 rows × 13 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#visualizing the newly added columns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Received&quot;</span><span class="p">,</span><span class="s2">&quot;Viewed&quot;</span><span class="p">,</span> <span class="s2">&quot;Completed&quot;</span><span class="p">],</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">final</span><span class="o">.</span><span class="n">offers_received</span><span class="p">,</span>
                 <span class="n">final</span><span class="o">.</span><span class="n">offers_viewed</span><span class="p">,</span>
                 <span class="n">final</span><span class="o">.</span><span class="n">offers_completed</span><span class="p">],</span>
            <span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">my_colors</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">]))</span>\
            <span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Offer-related actions&quot;</span><span class="p">);</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_130_0.png"></p>
<div class="highlight"><pre><span></span><span class="n">final</span><span class="o">.</span><span class="n">offers_received</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>count    7393.000000
mean        1.120790
std         0.340521
min         0.000000
25%         1.000000
50%         1.000000
75%         1.000000
max         2.000000
Name: offers_received, dtype: float64
</pre></div>


<div class="highlight"><pre><span></span><span class="n">final</span><span class="o">.</span><span class="n">offers_viewed</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>count    7393.000000
mean        0.774381
std         0.519072
min         0.000000
25%         0.000000
50%         1.000000
75%         1.000000
max         2.000000
Name: offers_viewed, dtype: float64
</pre></div>


<div class="highlight"><pre><span></span><span class="n">final</span><span class="o">.</span><span class="n">offers_completed</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>count    7393.000000
mean        0.277830
std         0.458997
min         0.000000
25%         0.000000
50%         0.000000
75%         1.000000
max         2.000000
Name: offers_completed, dtype: float64
</pre></div>


<p>It appears that even though in the events table there was a considerable amount of users who were assigned more than one offer, in the users table only about a half of users were assigned any offers and if they were, they were predominantly assigned only one. Therefore, it would make sense to filter out the users assigned more than one offer and reconsider the questions we wanted to answer.</p>
<div class="highlight"><pre><span></span><span class="c1">#filtering out users with more than one offer</span>
<span class="n">final</span> <span class="o">=</span> <span class="n">final</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">final</span><span class="o">.</span><span class="n">offers_received</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">final</span><span class="o">.</span><span class="n">shape</span>
</pre></div>


<div class="highlight"><pre><span></span>(6428, 13)
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#visualizing the offer-related metrics</span>
<span class="k">print</span><span class="p">(</span><span class="n">final</span><span class="o">.</span><span class="n">offers_viewed</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">final</span><span class="o">.</span><span class="n">offers_completed</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>


<div class="highlight"><pre><span></span>4537.0
1696.0
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#checking how many users viewed and completed an offer after receiving one</span>
<span class="n">completion_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">final</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;offers_viewed&#39;</span><span class="p">,</span> <span class="s1">&#39;offers_completed&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">completion_df</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>id</th>
    </tr>
    <tr>
      <th>offers_viewed</th>
      <th>offers_completed</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">0.0</th>
      <th>0.0</th>
      <td>1639</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>252</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">1.0</th>
      <th>0.0</th>
      <td>3093</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>1444</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">completion_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">not_completed</span> <span class="o">=</span> <span class="n">completion_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="n">final</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span>[1639 3093]
</pre></div>


<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">completion_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">completed</span> <span class="o">=</span> <span class="n">completion_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="n">final</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">completed</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">[ 252 1444]</span>





<span class="na">array([0.03920348, 0.22464219])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#visualizing results</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>
<span class="n">p1</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="s2">&quot;Not viewed&quot;</span><span class="p">,</span> <span class="s2">&quot;Viewed&quot;</span><span class="p">],</span> <span class="p">(</span><span class="n">completion_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">completion_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="n">my_colors</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">patch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">patches</span><span class="p">):</span>
  <span class="n">p1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.32</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">not_completed</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> 
          <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Not completed&quot;</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="s2">&quot;Not viewed&quot;</span><span class="p">,</span><span class="s2">&quot;Viewed&quot;</span><span class="p">],</span> <span class="n">completion_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
       <span class="n">bottom</span> <span class="o">=</span> <span class="n">completion_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">completion_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">my_colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
       <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Completed&quot;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
  <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">pa</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">patches</span><span class="p">):</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.32</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">+</span> <span class="mi">50</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">completed</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> 
          <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
  <span class="k">pass</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Actions after having received an offer&quot;</span><span class="p">);</span>
</pre></div>


<p><img alt="png" src="starbucks_dataset_exploration_files/starbucks_dataset_exploration_140_0.png"></p>
<p><em>Observation</em>: We can see that about 60% of users viewed the offer after being assigned one. However, less than a half completed an offer after vieweing it. While can't answer our initial research questions regarding "deals fatigue" with the data provided in the dataset, we can attempt profiling users who complete an offer after viewing it.</p>
<h1><strong>Question to answer (take 2)</strong></h1>
<p><strong>Q: For the users who viewed an offer, what characteristic of the user is the best predictor for a user to complete that offer?</strong></p>
<h1>Conclusion</h1>
<p>In this notebook, we attempted to clean and explore a dataset related to Starbucks' loyalty app. In this process, a question about possible "deal fatigue" emerged, as one of the tables indicated that most users have been assigned multiple offers. However, further wrangling of the data indicated that data about the completion of an offer contained only users who have been assigned one offer each. As a result, the question was reconsidered - as it became evident that only a half of users who view an offer, proceed on to complete it, it is necessary to identify main characteristics of users that lead them to complete an offer. This is the aim of the next stage of the project. Possible methods to answer that question include logistic regression aimed at predicting completion of an offer based on the user characteristics, and subsequent identification of feature importance.</p>
    </article>

    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                        <li>
                            <a href="">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                    <p class="copyright text-muted">Blog powered by <a href="http://getpelican.com">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://katkasian.github.io/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="https://katkasian.github.io/theme/js/bootstrap.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="https://katkasian.github.io/theme/js/clean-blog.min.js"></script>

</body>

</html>